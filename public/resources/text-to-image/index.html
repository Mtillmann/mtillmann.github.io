<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h1 class="display-3">Demos</h1>
            </div>
        </div>
        <div class="row mb-5">
            <div class="col-6">
                <h6 class="display-6">DOM Source</h6>
                <div data-is-source-node>
                    This is a simple demo of the text-to-image library. The text on the left will be rendered as an
                    image on the right.
                </div>
            </div>
            <div class="col-6">
                <h6 class="display-6">Image (SVG)</h6>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-6">
                <h6 class="display-6">DOM Source</h6>
                <div class="text-center" data-is-source-node>
                    You can also use simple HTML tags like <strong>bold</strong>, <em>italic</em>, and <u>underline</u>.
                    and alignment.
                </div>
            </div>
            <div class="col-6">
                <h6 class="display-6">Image (SVG)</h6>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-6">
                <h6 class="display-6">DOM Source</h6>
                <div data-is-source-node>
                    <p>Emojis are also supported! 😊</p>
                    <p>As are structural elements like <code>&lt;p&gt;</code></p>
                    <p>And lists</p>
                    <ul>
                        <li>Item 1</li>
                        <li>Item 2</li>
                        <li>Item 3</li>
                    </ul>
                </div>
            </div>
            <div class="col-6">
                <h6 class="display-6">Image (SVG)</h6>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-6">
                <h6 class="display-6">DOM Source</h6>
                <div class="text-bg-success font-monospace" data-is-source-node>
                    <p>
                        Built-in fonts are also supported. However, only the styles of
                        the context node are picked up by default. Styles on individual
                        elements inside the markup to render are lost:
                    </p>
                    <button class="btn btn-primary">The Button</button>
                    <button class="btn btn-info">Styles</button>
                    <button class="btn btn-secondary">Are Lost...</button>
                    <button class="btn btn-secondary" style="background:green">... while inline styles work</button>
                    <p>You could of course compile them yourself and pass them in the styles-option</p>
                </div>
            </div>
            <div class="col-6">
                <h6 class="display-6">Image (SVG)</h6>
            </div>
        </div>



        <div class="row mb-5">
            <div class="col-6">
                <h6 class="display-6">Off-DOM Source</h6>
                <div>
                    <script type="ignore/this" data-is-source-node data-use-parent-node="1">
                    This is text from a script tag with a type that is not recognized by the browser.
                    <br />
                    This useful when you want to render text that is not visible on the page.
                    <br />
                    Also this is an easy way to get around the the issue with self-closing tags.
                </script>
                </div>
                <p>
                    This example uses text from a script tag with a type that is not recognized by the browser.
                    When using a method like this, you'll have to provide a good context node yourself, since 
                    the script tag likely has no styles:
                </p>
                <code>
<xmp>
<script type="ignore/this" data-is-source-node data-use-parent-node="1">
    This is text from a script tag with a type that is not recognized by the browser.
    <br />
    This useful when you want to render text that is not visible on the page.
    <br />
    Also this is an easy way to get around the the issue with self-closing tags.
</script>
</xmp></code>
            </div>
            <div class="col-6">
                <h6 class="display-6">Image (SVG)</h6>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-6">
                <h6 class="display-6">Non-DOM Source</h6>
                
                <p>
                    The right column will render an image that was
                    entirely created from a string of text/markup.
                    Since no context node is provided, the image will
                    be rendered with the styles applied to <code>document.body</code>.
                    Also I provide the forced width option to make the image only 300px wide.
                </p>
                
            </div>
            <div class="col-6 non-dom-image">
                <h6 class="display-6">Image (SVG)</h6>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-6">
                <h6 class="display-6">DOM Source</h6>
                <div data-is-source-node data-render-as-canvas="1">
                    <p>
                        You can also render the text as a canvas element. 
                        Note how you can't drag and drop this element or open in a new tab, as opposed to a regular image.
                    </p>
                    <p>
                        Make sure to set <code>canvas.style.imageRendering = 'pixelated';</code> to avoid blurry text on high DPI screens.
                    </p>
                </div>
            </div>
            <div class="col-6">
                <h6 class="display-6">Image (Canvas)</h6>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-6">
                <h6 class="display-6">DOM Source</h6>
                <div data-is-source-node data-render-as-canvas-image="1">
                    <p>
                        Another way is to render the canvas back on a regular image element as a data URI.
                    </p>
                    <p>
                        Don't forget to set <code>imgElement.style.imageRendering = 'pixelated';</code> to avoid blurry text on high DPI screens.
                    </p>
                </div>
            </div>
            <div class="col-6">
                <h6 class="display-6">Image (Canvas / Image / Data URI)</h6>
            </div>
        </div>

        <div class="row mb-5">
            <div class="col-6">
                <h6 class="display-6">DOM Source</h6>
                <div data-is-source-node data-render-as-canvas-blob="1">
                    <p>
                        Going even further - you can create a blob from the canvas and use that as the source for an image.
                    </p>
                </div>
            </div>
            <div class="col-6">
                <h6 class="display-6">Image (Canvas / Image / Blob URI)</h6>
            </div>
        </div>


    </div>

    <script src="text-to-image.js"></script>

    <script>

        function toCanvas(img){
            const canvas = document.createElement('canvas')
            canvas.width = img.naturalWidth
            canvas.height = img.naturalHeight
            canvas.getContext('2d').drawImage(img, 0, 0)
            canvas.style.width = img.width + 'px'
            canvas.style.height = img.height + 'px'
            canvas.style.imageRendering = 'pixelated';
            return canvas
        }
    
        function toCanvasImage(img){
            const canvas = toCanvas(img);
            const dataURI = canvas.toDataURL('image/png');
            const imgElement = new Image();
            imgElement.src = dataURI;
            imgElement.width = img.width;
            imgElement.height = img.height;
            imgElement.style.imageRendering = 'pixelated';
            
            return imgElement;
        }

        window.addEventListener('load', async () => {
            const nodes = document.querySelectorAll('[data-is-source-node]');
            for(const node of nodes) {
                const context = !!node.dataset.useParentNode ? node.parentNode : node;
                const image = await textToImage(node.innerHTML, { context });

                if(node.dataset.renderAsCanvas){
                    node.closest('.row').querySelector('[class*="col"]:last-child').appendChild(toCanvas(image));
                    continue;
                }

                if(node.dataset.renderAsCanvasImage){
                    node.closest('.row').querySelector('[class*="col"]:last-child').appendChild(toCanvasImage(image));
                    continue;
                }

                if(node.dataset.renderAsCanvasBlob){
                    const canvas = toCanvas(image);
                    canvas.toBlob(blob => {
                        const url = URL.createObjectURL(blob);
                        const imgElement = new Image();
                        imgElement.src = url;
                        imgElement.width = image.width;
                        imgElement.height = image.height;
                        imgElement.style.imageRendering = 'pixelated';
                        node.closest('.row').querySelector('[class*="col"]:last-child').appendChild(imgElement);
                    });
                    continue;
                }

                node.closest('.row').querySelector('[class*="col"]:last-child').appendChild(image);
            }

            const image = await textToImage(`
                <style>table{border-collapse: collapse; margin-bottom:14px;}th,td{padding:3px; border:1px solid #000;}</style>
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th>DOM</th>
                            <th>Image</th>
                        </tr>
                    </thead>
                    <tbody style="text-align:center">
                    <tr>
                        <td>Interactive</td>
                        <td>✅</td>
                        <td>❌</td>
                    </tr>
                    <tr>
                        <td>Easy</td>
                        <td>✅</td>
                        <td>❌</td>
                    </tr>
                    <tr>
                        <td>Good Idea</td>
                        <td>✅</td>
                        <td>❌</td>
                    </tr>
                    <tr>
                        <td>Sneaky</td>
                        <td>❌</td>
                        <td>✅</td>
                    </tr>
                    </tbody>
                </table>
            `, {width: 300});

            document.querySelector('.non-dom-image').appendChild(image);
        });

    </script>


</body>

</html>